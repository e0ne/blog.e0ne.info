---
title: "Ajax и загрузка файлов на сервер"
date: 2008-09-14T11:30:00+03:00
draft: False
category: [.NET Framework,Web Development]
tags: [asp.net,ajax]
archives: [2008]
aliases:
    - post/Ajax-File-Upload.aspx
---


Время от времени приходится организовывать возможность загрузки пользователями файлов на сервер: загрузка аватарок, файлов для галереи и т.д.  

Для решения этой задачи существует стандартный ASP.NET компонент FileUpload, который, в свою очередь, педставляет html-тэг <input type="file" />. В простнйшем случае код для загрузки файлов будет выглядеть так:
	-  Default.aspx:<br />				<li style="font-family: 'Courier New', Courier, monospace; font-style: normal; font-variant: normal; font-weight: normal; font-size: 130%; line-height: normal; color: #003030">										<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="WebApplication1._Default" %>																		- 										 																		- 										<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">																		- 										 																		- 										<[html](http://december.com/html/4/element/html.html) xmlns="http://www.w3.org/1999/xhtml">																		- 										<[head](http://december.com/html/4/element/head.html) runat="server">																		- 										    <[title](http://december.com/html/4/element/title.html)></[title](http://december.com/html/4/element/title.html)>																		- 										</[head](http://december.com/html/4/element/head.html)>																		- 										<[body](http://december.com/html/4/element/body.html)>																		- 										    <[form](http://december.com/html/4/element/form.html) id="form1" runat="server">																		- 										    <[div](http://december.com/html/4/element/div.html)>																		- 										        [input](http://december.com/html/4/element/input.html) type="submit" value="Upload" />																		- 										    </[div](http://december.com/html/4/element/div.html)>																		- 										    </[form](http://december.com/html/4/element/form.html)>																		- 										</[body](http://december.com/html/4/element/body.html)>																		- 										</[html](http://december.com/html/4/element/html.html)>																		- 										 																		- 										 																<br />	</li>				- Default.aspx.cs								<li style="font-family: 'Courier New', Courier, monospace; font-style: normal; font-variant: normal; font-weight: normal; font-size: 130%; line-height: normal; color: #003030">										using System;																		- 										using System.Collections.Generic;																		- 										using System.Linq;																		- 										using System.Web;																		- 										using System.Web.UI;																		- 										using System.Web.UI.WebControls;																		- 										using System.IO;																		- 										 																		- 										namespace WebApplication1																		- 										{																		- 										    public partial class _Default : System.Web.UI.Page																		- 										    {																		- 										        protected void Page_Load(object sender, EventArgs e)																		- 										        {																		- 										            if (IsPostBack && fu.FileContent != null)																		- 										            {																		- 										                fu.PostedFile.SaveAs(path);																		- 										            }																		- 										        }																		- 										    }																		- 										}																		- 										 																		- 										 																</li>	- Default.aspx: <br />				<li style="font-family: 'Courier New', Courier, monospace; font-style: normal; font-variant: normal; font-weight: normal; font-size: 130%; line-height: normal; color: #003030">										<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="WebApplication1._Default" %>																		- 										 																		- 										<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">																		- 										 																		- 										<[html](http://december.com/html/4/element/html.html) xmlns="http://www.w3.org/1999/xhtml">																		- 										<[head](http://december.com/html/4/element/head.html) runat="server">																		- 										    <[title](http://december.com/html/4/element/title.html)></[title](http://december.com/html/4/element/title.html)>																		- 										</[head](http://december.com/html/4/element/head.html)>																		- 										<[body](http://december.com/html/4/element/body.html)>																		- 										    <[script](http://december.com/html/4/element/script.html) type="text/javascript">																		- 										        function onFormSubmit() {																		- 										            var formUpload = document.getElementById('form1');																		- 										            formUpload.target = 'upload_target';																		- 										            formUpload.action = 'default.aspx';																		- 										<br />												- 										        }																		- 										    </[script](http://december.com/html/4/element/script.html)>																		- 										    <[form](http://december.com/html/4/element/form.html) id="form1" onsubmit="onFormSubmit();">																		- 										    <[div](http://december.com/html/4/element/div.html)>																		- 										        <[input](http://december.com/html/4/element/input.html) id="file1" type="file" name="file1" /> <[br](http://december.com/html/4/element/br.html) />																		- 										        <[input](http://december.com/html/4/element/input.html) id="file2" type="file" name="file2" />																		- 										        																		- 										        <[input](http://december.com/html/4/element/input.html) type="submit" value="Upload" />																		- 										        																		- 										        <[iframe](http://december.com/html/4/element/iframe.html) id="upload_target1" name="upload_target" src="" style="width:0;height:0;border:0px solid #fff;"></[iframe](http://december.com/html/4/element/iframe.html)>																		- 										    </[div](http://december.com/html/4/element/div.html)>																		- 										    </[form](http://december.com/html/4/element/form.html)>																		- 										</[body](http://december.com/html/4/element/body.html)>																		- 										</[html](http://december.com/html/4/element/html.html)>																		- 										 							<br />	</li>				- Default.aspx.cs:<br />				<li style="font-family: 'Courier New', Courier, monospace; font-style: normal; font-variant: normal; font-weight: normal; font-size: 130%; line-height: normal; color: #003030">										using System;																		- 										using System.Collections.Generic;																		- 										using System.Linq;																		- 										using System.Web;																		- 										using System.Web.UI;																		- 										using System.Web.UI.WebControls;																		- 										using System.IO;																		- 										 																		- 										namespace WebApplication1																		- 										{																		- 										    public partial class _Default : System.Web.UI.Page																		- 										    {																		- 										        protected void Page_Load(object sender, EventArgs e)																		- 										        {																		- 										            if (IsPostBack)																		- 										            {																		- 										                HttpFileCollection uploads = HttpContext.Current.Request.Files;																		- 										                for (int i = 0; i < uploads.Count; i++)																		- 										                {																		- 										                    HttpPostedFile upload = uploads[i];																		- 										 																		- 										                    if (upload.ContentLength == 0)																		- 										                        continue;																		- 										 																		- 										                    upload.SaveAs(path);																		- 										                }																		- 										 																		- 										            }																		- 										        }																		- 										    }																		- 										}																		- 										 																		- 										 																</li>
