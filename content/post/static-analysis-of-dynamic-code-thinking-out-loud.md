---
title: "Статический анализ динамического кода: мысли вслух"
date: 2013-01-05T22:52:00+03:00
draft: False
category: [Offtopic]
tags: [python,pylint,refactoring,openstack]
archives: [2013]
aliases:
    - post/static-analysis-of-dynamic-code-thinking-out-loud.aspx
---



<p>В очередной раз чуть не наткнулся на давнюю проблему, но вовремя опомнился. При pylint “радостно” сообщил, что в некоторых модулях есть unused imports и их можно(нужно) удалить. Все было бы хорошо, если б не одно но: python очень даже динамический язык, а pylint ничего не знает о том, что будет происходить с кодом во время выполнения. Исходя из этого, уже можно представить какие проблемы могут быть. В моем случае, код был такой:

**from quantum.openstack.common import cfg<br />...<br />from quantum.plugins.openvswitch.common import config**

И pylint “ругался” на 2-й импорт, который нигде больше не использовался. Но если посмотреть на код этого модуля ([https://github.com/openstack/quantum/blob/master/quantum/plugins/openvswitch/common/config.py](https://github.com/openstack/quantum/blob/master/quantum/plugins/openvswitch/common/config.py)) и вспомнить как работает механизм импорта в Python’е, то становится ясно, какие проблемы могут быть: при загрузке модуля config, он устанавливает значения по умолчанию настроек. А так, как со всемы настройками принято работать через общий интерфейс cfg, и не импортировать можуль config, то, с большой вероятностью, где-то в runtime у нас произойдет исключение. 

Описанный выше пример простой и банальный, но приводит нас к двум простым правилам:


<ul>
- нельзя слепо доверять анализаторам кода, особенно, если этот код динамический;
- при проведении review кода нужно смотреть не только на новый/измененный фрагмент, а следует держать в голове полную картину и представлять как этот код будет работать с остальными частями приложения.
</ul>


Вот интересно, если бы не unit-тесты и понимание работы import’ов, сколько бы времени потратил на фикс бага, после такого “улучшения” кода?

