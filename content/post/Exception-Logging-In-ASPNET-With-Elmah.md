---
title: "Логирование ошибок в ASP.NET с помощью elmah"
date: 2011-02-25T21:30:00+03:00
draft: False
category: [.NET Framework,Web Development]
tags: [asp.net,logging,elmah,exceptions]
archives: [2011]
aliases:
    - post/Exception-Logging-In-ASPNET-With-Elmah.aspx
---


Чем дольше пользуюсь NuGet, тем больше интересных вещей с его нахожу. Одной из таких библиотек является [elmah](http://code.google.com/p/elmah/). Простота установки, особенно с использованием NuGet, и широкие возможности настройки подойдут к практически любому проекту. Я сам для этого раньше предпочитал использовать Logging модуль из Microsoft Enterprice Library, но сейчас понял что есть более гибкие и современные решения.

Elmah создан специально для того, чтобы логировать ошибки в ASP.NET приложениях.

Среди его функций есть такие:

- логирование ошибок в различные БД (MS Sql, Oracle, PostgreSQL, SQLite и др.);
- экспорт логов в формат CSV для последующего анализа;
- создание RSS-фида для получения информации о новых ошибках;
- отправление сообщений о новых исключениях прямо в ваш twitter!

Отдельно хочу сказать о логировании ошибок, которые произошли в момент обновления UpdatePanel - иногда это бывает очень полезно.

Если вы всё ещё по каким-то причинам не используете NuGet, то для вас установка будет происходить следующим способом:

- скачать сборку Elmah.dll (всего 156KB);
- добавить в ваш веб-проект reference на elmah;
- последний и самый сложный пункт - внести необходимые изменения в web.config.

Так как elmah работает как обычный web handler, то проблем с ним быть никаких не должно.

По умолчанию, вся информация об ошибках хранится в памяти, а это значит что данные будут храниться пока вы не перезапустите ваш веб-сервер.

Для того, чтобы посмотреть последние логи, необходимо открыть следующий URL: [http://localhost:8090/elmah.axd](http://localhost:8090/elmah.axd). В качестве тестового приложения я создал новый Web Application и посмотрел на логи:

<img src="/image.axd?picture=2011%2f2%2felmah.jpg" alt="" />

На удивление обнаружил, что в логах уже есть одна 404-я (Not Found) ошибка. Посмотрев на детали исключения сразу становится понятно, что не найден файл favicon.ico.

Для примера, я поместил на страницу кнопку, обработчик OnClick которой бросает исключение:

**throw new NotImplementedException();**

Посмотрим теперь на нашм логи:

<img src="/image.axd?picture=2011%2f2%2f500.jpg" alt="" />

У нас появилась запись с кодом 500 (Server Error) и типом NotImplemented.

В деталях каждой записи кроме времени и текста ошибки хранится полный callstack, все параметры, которые пришли в запросе (Request.Params) и, на мой взгляд самое интересное - ссылка с именем “Original ASP.NET error page”. Перейдя по ней можно посмотреть как выглядела страница, когда произошла ошибка. Таким образом можно увидеть что показывалось пользователю, когда это случилось.

Последняя фича, о которой я хотел бы сказать - это возможность настройки фильтрации исключений. Это позволит вам логировать только те исключения, которые вам необходимы.

На этом мой короткий обзор закончен. Более детально об elmah можно прочитать на официальной странице ([http://code.google.com/p/elmah/](http://code.google.com/p/elmah/)). Моей целью не было написать полный и подробный обзор-руководство по этой очень удобной и полезной библиотекой. Цель этого поста - всего-лишь познакомить с elmah тех читателей, которые еще не слышали о ней.

P.S. Для самых ленивых выложил тестовый проект на GitHub: [https://github.com/e0ne/BlogSamples/tree/master/ElmahSampleProject](https://github.com/e0ne/BlogSamples/tree/master/ElmahSampleProject)

